{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
	<div class="bg-white rounded-4 shadow p-4">
		<div class="d-flex justify-content-between align-items-center">
			<h3>Thank you for your order!</h3>
			<a href="{{ url_for('menu') }}" class="btn btn-outline-secondary">Continue Shopping</a>
		</div>
		<p class="small-muted">Order #{{ order.id }} placed on {{ order.created_at.strftime('%Y-%m-%d %H:%M') if order.created_at else '' }}</p>

		<div class="my-4">
			<div class="progress-step">
				<div class="bar" id="statusBar"></div>
			</div>
			<div class="d-flex justify-content-between small mt-2">
				<span>Processing</span>
				<span>Brewing</span>
				<span>Out for Delivery</span>
				<span>Delivered</span>
			</div>
		</div>

		<h5>Order Details</h5>
		<ul class="list-group list-group-flush">
			{% for item in order.items %}
				<li class="list-group-item d-flex justify-content-between align-items-center">
					<div>
						<div class="fw-semibold">{{ item.product.name }}</div>
						<div class="small-muted">x {{ item.quantity }}</div>
					</div>
					<div>{{ (item.unit_price * item.quantity)|currency }}</div>
				</li>
			{% endfor %}
			<li class="list-group-item d-flex justify-content-between align-items-center">
				<span class="fw-semibold">Total</span>
				<span class="fw-semibold">{{ order.total|currency }}</span>
			</li>
		</ul>

		<div class="mt-4">
			<h6>Delivery Information</h6>
			<p class="small">{{ order.customer_name }} â€¢ {{ order.phone }}<br>{{ order.address }}</p>
			<p class="small-muted"><i class="fa-solid fa-circle-info me-1"></i> Delivery option: {{ order.delivery_option }}</p>
		</div>
	</div>
</div>
{% endblock %}
{% block scripts %}
<script>
	const orderId = {{ order.id }};
	async function pollStatus() {
		try {
			const res = await fetch("{{ url_for('order_status', order_id=order.id) }}");
			const data = await res.json();
			const mapping = { 'processing': 10, 'brewing': 40, 'out_for_delivery': 70, 'delivered': 100 };
			document.getElementById('statusBar').style.width = (mapping[data.status] || 10) + '%';
			if (data.status !== 'delivered') setTimeout(pollStatus, 4000);
		} catch (e) { console.error(e); }
	}
	pollStatus();
</script>
{% endblock %}